<html lang="en">
<head>
    <meta charset="utf-8">
    <title>朱李叶健康</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimal-ui">
    <meta name="apple-mobile-web-app-status-bar-style" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description" content="医聊">
    <link rel="icon" type="image/x-icon" href="favicon.png">

    <!-- JQuery -->
    <script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

</head>
<style>
    * {
        margin: 0px;
        padding: 0px
    }

</style>

<body>
<div class="container" style="background: url(images/bg.png) no-repeat center; width: 100%;height: 100%">

    <div style="margin: 30px auto;width:300px;height: 80px">
        <div style="float:left; width:72px;height: 72px">
            <img id="docAvatar" class="img-rounded" src="images/doctor_avatar_woman.png">
        </div>
        <div style="float:left;width:190px;height: auto;margin-left: 30px">
            <div>
                <span class="nameAndPhone" id="docName">
                热线小助理
                </span>
                <img src="images/phone.png" style="margin-left: 18px;margin-top:-5px;width: 12px;height: 18px">
                <span class="nameAndPhone" id="docChatNum">
                    00120
                </span>
            </div>

            <div style="margin-top: 10px;">
                <ul>
                    <li style="list-style-type:none;">
                        <span id="department" class="docInfo"></span>
                        <span id="position" class="docInfo" style="margin-left: 10px"></span>
                    </li>
                    <li style="list-style-type:none;"><span id="hospital" class="docInfo"></span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="intruduction" style="margin: 0px auto;width:300px;height: auto;text-align:left" class="introduce">
        你好，我是热线小助理。如果诊后你有问题需要咨询，请点击下方按钮下载医聊APP，安装后在拨号盘中拨打00120和我联系。
    </div>

    <div style="margin: 5px auto;width:300px;height: auto;text-align:right;" class="introduce">
        祝早日康复!
    </div>

    <div style="margin: 50px auto 0px auto;text-align:center">
        <img src="images/logo_c.png" style="width: 76px;height: 76px;">
    </div>

    <div style=" margin:10px auto; text-align:center">
        <img src="images/download_ios.png" style="width:280px" height="38px" alt="" onclick="downloadIos()">
    </div>
    <div style="margin:0px auto; text-align:center;">
        <img src="images/download_and.png" style="width:280px" height="38px" alt="" onclick="downloadAndroid()">
    </div>
</div>

<style>
    .nameAndPhone {
        color: #FFF;
        font-size: 18px;
    }

    .docInfo {
        color: #FFF;
        font-size: 16px;
    }

    .introduce {
        color: #000;
        font-size: 15px;
    }

    .tishi {
        display: none;
        color: #FFF;
        position: fixed;
        left: 0px;
        top: 0px;
        right: 0px;
        bottom: 0px;
        width: 100%;
        background: url('images/03.png');
        min-height: 450px;
    }

    #tishi img {
        width: 100%;
        display: block;
        margin: 0;
    }
</style>

<div id="tishi" class="tishi">
    <img src="images/02.png"/>
</div>

<script>
    //更新医师信息
    $(function () {
        var params = location.search; //获取url中"?"符后的字串
        if (params) {
            docChatNum = params.split('=')[1];
            if (docChatNum) {
                console.log("docChatNum:" + docChatNum);
                $.ajax({
                    url: 'https://pro.mtxhcare.com/1/doctor/infoByDocChatNum?docChatNum=' + docChatNum,
                    type: 'GET',
                    success: function (result) {
                        Doctor = result;
                        updateDoctorInfo(Doctor);
                    }
                });
            }
        }
    });

    //纪录医师被扫码
    $(function () {
        var params = location.search; //获取url中"?"符后的字串
        if (params) {
            docChatNum = params.split('=')[1];
            if (docChatNum) {
                console.log("docChatNum:" + docChatNum);
                $.ajax({
                    url: 'http://api.dc.zlycare.com/1/doctor/scanQRCode?docChatNum=' + docChatNum,
                    type: 'GET',
                    success: function (result) {
//                        console.log("success:" + result);
                    }
                });
            }
        }
    });

    var isWX = function () {
        var ua = navigator.userAgent.toLowerCase();
        if (ua.match(/MicroMessenger/i) == "micromessenger") {
            return true;
        } else {
            return false;
        }
    };

    var downloadAndroid = function () {
        if (isWX()) {
            document.getElementById("tishi").style.display = "block";
        } else {
            window.location.href = "https://cdn.juliye.net/docchat-c-internal-4.apk";
        }
    };

    var downloadIos = function () {
        if (isWX()) {
            document.getElementById("tishi").style.display = "block";
        } else {
            window.location.href = "itms-services://?action=download-manifest&url=https://dn-juliye.qbox.me/DocChat-C-iphone-internal-5.plist";
        }
    };

    var Doctor;
    $('#docAvatar').error(function () {
        if (Doctor) {
            if (Doctor.sex == '男')
                $(this).attr('src', "images/doctor_avatar_man.png");
            else
                $(this).attr('src', "images/doctor_avatar_woman.png");

            return;
        }

        $(this).attr('src', "images/doctor_avatar_woman.png");
    });

    var updateDoctorInfo = function (doctor) {
//        console.log("success:" + JSON.stringify(doctor));

        document.getElementById("docAvatar").src = "https://cdn.juliye.net/" + doctor.avatar + "?imageView2/2/w/80/h/80";
        document.getElementById("docName").innerHTML = doctor.realName;
        document.getElementById("docChatNum").innerHTML = doctor.docChatNum;
        document.getElementById("department").innerHTML = doctor.department;
        document.getElementById("position").innerHTML = doctor.position;
        document.getElementById("hospital").innerHTML = doctor.hospital;
        document.getElementById("intruduction").innerHTML = "你好，我是" + doctor.realName + "医生。如果诊后你有问题需要咨询，请点击下方按钮下载医聊APP，安装后在拨号盘中拨打" + doctor.docChatNum + "和我联系。";
    };
</script>
</body>
</html>
