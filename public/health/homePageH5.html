<!DOCTYPE html>
<html lang="en">
<script>

</script>
<head>
    <meta charset="UTF-8">
    <title>健康头条</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="yes">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimal-ui">
    <link href="./styles/flowPage.css" rel="stylesheet" type="text/css">
</head>

<body>
<div style="margin-left:12px;margin-right:12px;">
    <img id="downloadImg" src="images/downloadingapp.png" style="margin-top: 10px;width: 100%;" onclick="download()">
</div>
<div style="margin-left:12px;margin-right:12px;margin-bottom: 15px">
    <header style="margin-top: 15px;">
        <div id="special" class="titleCss">
            <img id="specialImg"
                 style="width: 54px;height: 54px;border-radius: 54px;display: inline-block;margin-bottom: 16px"
                 class="left">

            <input type="button" id="favorite" class="favoriteBtnH5" style="margin-top: 10px" value="关注">
            <div id="service" style="width:85px;height: 21px;float: right;margin-right: 30px;margin-top: 14px;display:none;">
                <img src="images/serve.png" style="width: 16px;height: 15px;margin-top:4px;display: block;float: left;">
                <span style="width:60px;height:22px;line-height:22px;font-size: 15px;color: #12B6BB;letter-spacing: -0.36px;display: block;float: left;margin-left: 5px;">服务详情</span>
            </div>

            <div style="clear:both;">
                <label id="specialSource" class="source" style="margin-left: 0px;"></label>
                <br>
                <label id="specialDepartment" class="source"
                       style="margin-left: 0px;font-size: 15px;color: #999999;"></label>
            </div>
        </div>
    </header>
</div>

<div style="border: 1px solid #F4F4F4;">
    <div style="font-size: 19px;line-height: 29px;letter-spacing: 0.8px;word-wrap: break-word;color: #222222;text-align: justify"
         id="mainBody">
        <!--<div style="margin-top: 15px;border-bottom: 1px solid #F4F4F4">-->
        <!--<div style="margin-right: 15px">-->
        <!--<label>假蜂蜜危害大！70岁蜂农教你一杯清水，鉴别真假防受骗</label>-->
        <!--<div>-->
        <!--<img src='./images/nice.png' width="100px" height="73px">-->
        <!--<img src='./images/nice.png' width="100px" height="73px">-->
        <!--<img src='./images/nice.png' width="100px" height="73px">-->
        <!--</div>-->
        <!--</div>-->

        <!--<div style="padding-top:10px;margin-bottom:15px;font-size: 13px;-->
        <!--color: #999999;-->
        <!--line-height: 12px;">-->
        <!--<label>胡明月</label><label>09-01</label>-->
        <!--</div>-->
        <!--</div>-->

        <!--<div style="margin-top: 15px;border-bottom: 1px solid #F4F4F4">-->
        <!--<div style="margin-right: 15px;">-->
        <!--<label>假蜂蜜危害大！70岁蜂农教你一杯清水，鉴别真假防受骗</label>-->
        <!--<div>-->
        <!--<img src='./images/nice.png' width="100px" height="73px">-->
        <!--<img src='./images/nice.png' width="100px" height="73px">-->
        <!--<img src='./images/nice.png' width="100px" height="73px">-->
        <!--</div>-->
        <!--<div style="padding-top:10px;margin-bottom:15px;font-size: 13px;-->
        <!--color: #999999;-->
        <!--line-height: 12px;">-->
        <!--<label>胡明月</label><label>09-01</label>-->
        <!--</div>-->
        <!--</div>-->

        <!--</div>-->


        <!--<div style="margin-top: 15px;border-bottom: 1px solid #F4F4F4">-->
        <!--<div style="margin-right: 15px;">-->

        <!--<div>-->
        <!--<label style="width: 200px;float: left;">假蜂蜜危害大！70岁蜂农教你一杯清水...</label>-->
        <!--<img src='./images/nice.png' width="100px" height="73px" style="float: right;display: inline-block">-->

        <!--</div>-->

        <!--<div style="clear:both;padding-top: 10px;margin-bottom:15px;font-size: 13px;color: #999999;line-height: 12px;">-->
        <!--<label>胡明月</label><label>09-01</label>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->

        <!--<div style="margin-top: 15px;border-bottom: 1px solid #F4F4F4">-->
        <!--<div style="margin-right: 15px;">-->

        <!--<div>-->
        <!--<label style="width: 330px;">假蜂蜜危害大！70岁蜂农教你一杯清水，鉴别真假防受骗</label>-->
        <!--</div>-->

        <!--<div style="clear:both;padding-top: 10px;margin-bottom:15px;font-size: 13px;color: #999999;line-height: 12px;">-->
        <!--<label>胡明月</label><label>09-01</label>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->

        <!--<div style="margin-top: 15px;border-bottom: 1px solid #F4F4F4">-->
        <!--<div style="margin-right: 15px;">-->
        <!--<label>假蜂蜜危害大！70岁蜂农教你一杯清水，鉴别真假防受骗</label>-->
        <!--<div style="margin-top: 10px">-->
        <!--<img src='./images/nice.png' width="330px" height="219px">-->
        <!--</div>-->
        <!--<div style="padding-top:10px;margin-bottom:15px;font-size: 13px;-->
        <!--color: #999999;-->
        <!--line-height: 12px;">-->
        <!--<label>胡明月</label><label>09-01</label>-->
        <!--</div>-->
        <!--</div>-->

        <!--</div>-->
    </div>
</div>
</body>
<script src="libs/jquery.min.js"></script>
<script src="libs/common.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
  var NUM, shareTitle = '朱李叶健康', shareDes = '', shareImg = '', userId, authorId, token, authorType, deviceId,
    authorInfo;
  var WIDTH = window.screen.width, imgUri = 'https://cdn.juliye.net/';

  window.onload = function () {
    NUM = parseInt(WIDTH / 22);
    userId = getUrlQueryObject().userId, authorId = getUrlQueryObject().authorId,
      token = getUrlQueryObject().token,
      authorType = getUrlQueryObject().authorType,
      deviceId = getUrlQueryObject().deviceId;


    //作者信息
    $.ajax({
      type: "GET",
      url: "/1/feedFlow/getAuthorInfo?userId=" + userId + "&deviceId=" + deviceId + "&authorId=" + authorId + "&authorType=" + authorType,
      headers: {
        "x-docchat-user-id": userId,
        "x-docchat-session-token": token,
        "x-docchat-application-device-mark": deviceId
      },
      success: function (ret) {
        console.log();
        if (ret) {
          if (ret.hasService) {
            $("#service").show();
            $("#service").click(function () {
              window.open("/1/servicepackage/doctor_home_page?doctorId=" + ret.doctor_id);
            });
          }

          //作者健康号列表
          $.ajax({
            type: "GET",
            url: "/1/feedFlow/getAuthorPageList?userId=" + userId + "&deviceId=" + deviceId + "&authorId=" + authorId + "&authorType=" + authorType,
            headers: {
              "x-docchat-user-id": userId,
              "x-docchat-session-token": token,
              "x-docchat-application-device-mark": deviceId
            },
            success: function (ret) {
              if (ret) {
                console.log('文章列表', ret);
                var mainBody = '';
                for (var i = 0; i < ret.length; i++) {
                  mainBody += getDataRow(ret[i], authorInfo);
                }
                $('#mainBody').html(mainBody);
              } else {
                alert('获取健康页信息失败');
              }
            }
          });
          authorInfo = ret;
          console.log('作者信息', authorInfo);
          var source = '';
          $('#specialImg').attr('src', imgUri + ret.avatar);
          if (authorType == 'doctor') {
            source = ret.name + ' | ' + ret.title;
            $('#specialDepartment').html(ret.department + ' | ' + ret.hospital);
          } else if (authorType == 'factory') {
            source = ret.name;
            $('#specialDepartment').css('display', 'none');
          }


          $('#specialSource').html(source);

          $('#special').css('display', 'block');
          shareDes = '推荐《' + ret.name + '》的主页';
          shareImg = imgUri + ret.avatar;
          wxShare(shareTitle, shareDes, shareImg, window.location.href);
        } else {
          alert('获取作者信息失败');
        }
      }
    });

  };


  $('#favorite').click(function () {
    download();
  });

  //主页列表插入数据
  function getDataRow(row, authorInfo) {
    var retItem;
    var title = row.title, source = row.user_name, width = (WIDTH - 30) / 3, height = 73 * width / 110;
    if (title.length > 2 * NUM) {
      title = title.substr(0, 2 * NUM - 2) + '...';
    }

    if ((row.authorType == 'doctor' || row.authorType == 'factory')) {
      source = authorInfo.name;
    }
    var picsLength = row.pics.length;
    if (row.formatType == 'imagetext') {//一张图大图模式
      width = WIDTH - 30, height = 73 * width / 110;

      retItem = '<div id="' + row.moment_id + '_' + row.formatType + '" class="homeBodyWrap"><div class="item"><div><label>'
        + title
        + '</label><div'
        + '><img src='
        + row.pics[0] + ' width='
        + width + 'px height='
        + height + 'px></div> <div style="position:absolute;right: 10px;bottom:'
        + 55 + 'px;opacity: 0.5;background: #000000;border-radius: 9px;width: 43px;height: 18px"> <img src="./images/bigPictureNum@3x.png" width="11px" height="9px" style="margin-left: 6px;margin-bottom: 7px;"> <label id="bigPictureNum" style="clear:both;vertical-align:middle;display:inline-block;line-height:14px;'
        + 'font-size: 10px;color: #FFFFFF;margin-left:-3px;margin-bottom: 12px;">'
        + picsLength + '图</label> <span/> </div><div style="padding-top:10px;margin-bottom:15px;font-size: 13px;color: #999999;line-height: 12px;"> <label>'
        + formatSourceList(source)
        + '</label>'
        + '</div> </div></div></div>';
    } else if (picsLength == 0) {//无图模式
      retItem = '<div id="' + row.moment_id + '_' + row.formatType + '" class="homeBodyWrap"><div class="item"> <div> <div> <label style="width: 330px;">'
        + title
        + '</label> </div> <div style="clear:both;padding-top: 10px;margin-bottom:15px;font-size: 13px;color: #999999;line-height: 12px;"> <label>'
        + formatSourceList(source)
        + '</label>'
        + '</div> </div> </div></div>';
    } else if (picsLength < 3) {//一张图普通样式
      retItem = '<div id="' + row.moment_id + '_' + row.formatType + '" class="homeBodyWrap"><div class="item"> <div> <div><div id=' +
        +row.moment_id + '' +
        '_' + row.formatType + '_titleLengthCss class="titleLengthCss" style="height:'
        + 2 * 28 * (width - 9) / 91
        + 'px;line-height:'
        + 28 * (width - 9) / 91
        + 'px;overflow:hidden;width: '
        + (WIDTH - width - 46)
        + 'px;">'
        + title
        + '</div>'
        + '<div style="clear:both;'
        + 'padding-top: 10px;'
        + 'margin-bottom:15px;font-size: 13px;color: #999999;line-height: 12px;"> <label>'
        + formatSourceList(source)
        + '</label> '
        + '</label> </div>'
        + '<img src='
        + row.pics[0]
        + '  width='
        + (width - 5)
        + ' height='
        + (height + 5) + ' style="position: absolute;top: 5px;right: 15px;display: inline-block"> </div> </div> </div></div>';
    } else {
      retItem = '<div id="' + row.moment_id + '_' + row.formatType + '" class="homeBodyWrap"><div class="item"> <div> <label>'
        + title
        + '</label> <div> <img src='
        + row.pics[0] + ' width='
        + (width - 5)
        + 'px height='
        + height + 'px> <img src='
        + row.pics[1]
        + ' width='
        + (width - 5)
        + 'px height='
        + height + 'px"> <img src='
        + row.pics[2]
        + ' width='
        + (width - 5)
        + 'px height='
        + height + 'px"> </div> </div> <div style="padding-top:10px;margin-bottom:15px;font-size: 13px;color: #999999;line-height: 12px;"> <label>'
        + formatSourceList(source)
        + '</label>'
        + '</div></div></div>';
    }
    return retItem;
  }

  //监听touch事件，跳转到推荐文章详情
  document.getElementById('mainBody').addEventListener('touchend', touch, true);
  //document.getElementById('recPages').addEventListener('touchmove', touch, true);
  document.getElementById('mainBody').addEventListener('touchstart', touch, true);
  document.getElementById('mainBody').addEventListener('click', touch, true);
  document.getElementById('mainBody').addEventListener('touchcancel', touch, true);

  function touch(event) {
    var event = event || window.event;
    var target = getEventId(event.target);
    var paramArr = target.split('_');
    var id = paramArr[0], formatType = paramArr[1];

    switch (event.type) {
      case "touchstart":
        modifyTouchTitle(id, formatType);
        break;
      case "touchend":
        resumeTouchTitle(id, formatType);
        break;
      case "touchmove":
        break;
      case "click":
        goPageDetailH5(id);
        break;
      case "touchcancel":
        resumeTouchTitle(id, formatType);
        break;
    }
  }


  //跳转到详情页时，跳转到H5页面
  function goPageDetailH5(pageId) {
    window.location.href = '/health/pageH5.html?userId=' + userId + '&deviceId=' + deviceId + '&token=' + token + '&pageId=' + pageId;
  }

</script>
</html>
