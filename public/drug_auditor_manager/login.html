<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=3, minimum-scale=1, user-scalable=no">
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <title>身份验证</title>

  <script src="https://cdn.bootcss.com/vue/2.5.13/vue.min.js"></script>
  <script src="https://cdn.bootcss.com/vue-resource/1.5.0/vue-resource.js"></script>

  <style>
    html,
    body {
      margin: 0;
    }

    #app {
      padding-top: 40px;
    }

    .form-item {
      margin-left: 20px;
      margin-right: 20px;
      font-size: 15px;
      color: #000000;
      letter-spacing: 0.04px;
      position: relative;
      display: flex;
    }

    .form-item:after {
      content: ' ';
      display: block;
      clear: both;
    }

    .item-left,
    .item-right {
      display: block;
      padding-top: 10px;
      padding-bottom: 10px;
    }

    .item-left {
      position: absolute;
      top: 4px;
      display: block;
    }

    .item-right {
      width: 100%;
      margin-left: 96px;
      border-bottom: 1px solid #E0E0E0;
      padding-right: 15px;
    }

    .item-right input {
      width: 100%;
      font-size: 15px;
      color: #000000;
    }

    .form-submit-wrap {
      padding-left: 30px;
      padding-right: 30px;
    }

    .form-submit {
      border: 0;
      background: #12B6BB;
      border-radius: 4px;
      height: 44px;
      line-height: 44px;
      text-align: center;
      font-size: 15px;
      color: #FFFFFF;
      letter-spacing: -0.36px;
      width: 100%;
      margin-top: 40px;
    }

    input:focus {
      outline: 0;
    }

    .to-url {
      position: absolute;
      display: block;
      right: 0;
      top: 17px;
      width: 13px;
      height: 13px;
      background: url(/drug_auditor_manager/img/arrowrignt@3x.png) no-repeat;
      background-size: 100% 100%;
    }

    input {
      border: 0;
    }
  </style>
</head>

<body>
  <div id='app'>
    <div class="form-item">
      <div class="item-left">
        姓名
      </div>
      <div class="item-right">
        <input v-model="name" placeholder="请输入姓名" maxlength="10"/>
      </div>
    </div>
    <div class="form-item">
      <div class="item-left">
        手机号
      </div>
      <div class="item-right">
        <input v-model="phone" placeholder="请输入手机号" maxlength="11"/>
      </div>
    </div>
    <div class="form-item">
      <div class="item-left">
        所属渠道
      </div>
      <div class="item-right" v-on:click='changeChannel'>
        <input readonly v-model="show_name" placeholder="选择药店/医院" v-on:click='changeChannel'  />
        <span class="to-url"></span>
      </div>
    </div>

    <div class="form-submit-wrap">
      <button class="form-submit" v-on:click="submit" v-bind:disabled="dis">提交</button>
    </div>

  </div>
</body>
<script>
  new Vue({
    el: '#app',
    data: {
      id: '<%-locals._id%>',
      name: '<%-locals.name%>',
      phone: '<%-locals.phone%>',
      channel: '<%-locals.channel_id%>',
      channel_name: '<%-locals.channel_name%>',
      province: '<%-locals.province%>',
      city: '<%-locals.city%>',
      county: '<%-locals.county%>',
      show_name: '<%-locals.show_name%>',
      dis : false
    },

    methods: {
      changeChannel() {
        var src = '/select_channel/select-channel.html?province='
          + this.province 
          + "&city=" + this.city
          + '&county=' + this.county
          + '&name=' + this.name
          + '&phone=' + this.phone;
        window.location.href = src;
      },
      submit: function () {
        if(!this.name){
          alert("请输入姓名");
          return;
        }
        if(!this.phone || !(/^1([358][0-9]|4[579]|66|7[0135678]|9[89])[0-9]{8}$/.test(this.phone))){
          alert("请输入正确的手机号");
          return;
        }

        if(!this.channel){
          alert("请选择所属渠道");
          return;
        }
        this.dis = true;
        this.$http({
          method: 'POST',
          url: "/drug_auditor_manager/registered",
          body: {
            id: this.id,
            name: this.name,
            phone: this.phone,
            channel: this.channel,
          },
        }).then(function (res) {
          console.log(res);
          // 跳转 list
          this.dis = false;
          window.location.href = '/drug_auditor_manager/index'
        }, function (err) {
          this.dis = false;
          alert("失败");
        });
      }
    }
  })

  window.alert = function (name) {
    var iframe = document.createElement("IFRAME");
    iframe.style.display = "none";
    iframe.setAttribute("src", 'data:text/plain,');
    document.documentElement.appendChild(iframe);
    window.frames[0].window.alert(name);
    iframe.parentNode.removeChild(iframe);
  }
</script>

</html>