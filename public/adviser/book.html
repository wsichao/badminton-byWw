<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>我要预约</title>
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="format-detection" content="telephone=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
  <!-- JQuery -->
  <script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
  <script src="../../assets/libs/bootstrap.min.js"></script>
  <!-- Private -->
  <link rel="stylesheet" href="../../assets/styles/bootstrap.min.css">
  <link href="adviser/dot_adviser.css" rel="stylesheet" type="text/css">
  <!-- <link href="adviser/adviser_main.css" rel="stylesheet" type="text/css">-->
  <style>
    body{
      height: 100%;
      background: url("http://7j1ztl.com1.z0.glb.clouddn.com/webcall_book.png") no-repeat;
      /* -moz-background-size:100%;
       background-size:100%;*/
      filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale')";
      -moz-background-size:100vw 100vh;
      background-size:100vw 100vh;
    }
  </style>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6bfdaad88f72215f7d84ab875eb58f0d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
      _hmt.push(['_trackPageview', "/webcall/reg"]);
    })();
  </script>
</head>
<body style="height: auto">
<div class="book_back">

  <ul class="book_list">
    <li>
      <label>称 &nbsp;&nbsp;&nbsp;呼</label>
      <input type="text" id="name">
    </li>
    <li>
      <label>手 &nbsp;&nbsp;&nbsp;机</label>
      <input type="text" id="phoneNum">
      <button id="veriBookbtn"  disabled >获取验证码</button>
    </li>
    <li>
      <label>验证码</label>
      <input type="text" id="verification">
    </li>
    <li id="book_btn" class="book_btn">
      <button id="book" disabled style="font-family: '黑体';">我要预约</button>
    </li>
  </ul>
</div>

<script>
  window.alert = function(name){
    var iframe = document.createElement("IFRAME");
    iframe.style.display="none";
    iframe.setAttribute("src", 'data:text/plain,');
    document.documentElement.appendChild(iframe);
    window.frames[0].window.alert(name);
    iframe.parentNode.removeChild(iframe);
  }
  function getUrlQueryObject(){
    var query = decodeURIComponent(window.location.search.substring(1));
    var urlArray = query.split('&'),queryObj = {};
    urlArray.forEach(function(item){
      var itemArray =  item.split('=');
      queryObj[itemArray[0]] = itemArray[1];
    })
    return queryObj;
  }
  $(function(){

    $(".book_back").click(function(){
      $(".book_back").css("background","rgba(0,0,0,0.6)");

    });

    var phoneNum = $("#phoneNum");
    var phoneNumber = phoneNum.val();
    function phone(phoneNumber1) {
      var reg = /^(13|15|18|17)[0-9]{9}$/;
      if(phoneNumber1=="" || !reg.test(phoneNumber1)){
        return 0;
      }else{
        return 1;
      }
    }

    var veribtn=$("#veriBookbtn");

    phoneNum.on('input',function(e){
      var phone_flag=phone(this.value);
      if(phone_flag===1){
        // alert("hhh");
        veribtn.attr("disabled",false);
      }else{
        // alert("333");
        //console.log("444")
      }

    });


    //获取验证码
    veribtn.click(function (){
      var phone_flag=phone($("#phoneNum").val());
      //  alert(phone_flag);
      if(phone_flag===1) {
        /*veribtn.css("background", "rgba(50,164,238,0.50)");*/
        veribtn.attr("disabled", true);

        var timecount = 60;
        var IntervalName = setInterval(function () {
          if (timecount >= 0) {
            //veribtn.css("font-size", "17px");
            veribtn.text(timecount+"s");
            timecount--;
          } else {
            clearInterval(IntervalName);
            /*veribtn.css("background-color", "#33A5EE");*/
            veribtn.attr("disabled", false);
            //veribtn.css("font-size", "15px");
            veribtn.text("获取验证码");
          }

        }, 1000);
        var phoneNum = $("#phoneNum").val();
        $.ajax({
          url: '/1/common/authCode?phoneNum=' + phoneNum,
          type: 'GET',
          success: function (result) {
            console.log("获取验证码成功");
            $("#book").attr("disabled", false);//写在ajax success里面
          }
        });
      }



    });

    $("#book").click(function(){
      var name=$("#name");
      phoneNumber = phoneNum.val();
      var verification=$("#verification");
      if(name.val()==""){
        alert("请输入您的称呼");
        return;
      }
      if(phoneNumber==""){
        alert("请输入手机号");
        return;
      }else{
        var phone_flag=phone(phoneNumber);
        if(phone_flag===0){
          alert("请输入正确的手机号");
          return;
        }
      }
      if(verification.val()==""){
        alert("请输入验证码");
        return;
      }
      var data={};
      data.name=name.val();
      data.phoneNum=phoneNumber;
      data.authCode=verification.val();
      data.source = getUrlQueryObject().from;
      sucPhone(data);



    });



    function sucPhone( sucdata ){
      // $(".alert").hide();
      $.ajax({
        url: '/1/customer/webcallRegister',
        type: 'POST',
        data: JSON.stringify(sucdata),
        dataType:'json',
        headers : {
          "Content-Type": 'application/json'
        },
        success: function (result) {
          alert("预约成功");
          window.location.href="adviser/download.html";
          /*suc_alert.show();
           gray.show();
           $("#alert").hide();
           closeSuccessAlert();
           $("#err_info").hide();
           $("#verification").val("");
           changeLocation();*/
        },
        error: function (err) {
          console.log(err);
          if( JSON.parse(err.responseText).code == 1502){
            alert("验证码错误");
          }
          if( JSON.parse(err.responseText).code == 1528){
            alert("用户已存在");
          }
        }
      });

    }

  })


</script>
</body>
</html>