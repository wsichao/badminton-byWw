<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>朱李叶健康</title>
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="format-detection" content="telephone=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
  <!-- JQuery -->
  <script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
  <script src="../../assets/libs/bootstrap.min.js"></script>
  <!-- Private -->
  <link rel="stylesheet" href="../../assets/styles/bootstrap.min.css">
  <link href="adviser/new_adviser.css" rel="stylesheet" type="text/css">
  <!-- <link href="adviser/adviser_main.css" rel="stylesheet" type="text/css">-->
  <style>
    ul{
      padding:0;
      margin:0;
      list-style: none;
    }
    body{
      height: 100%;
      /*background: url("http://7j1ztl.com1.z0.glb.clouddn.com/webcall_view3.jpeg") no-repeat;
       -moz-background-size:100%;
       background-size:100% 100vh;*/
      /*filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale')";
      -moz-background-size:100vw 100vh;
      background-size:100vw auto;*/
    }
    @media (min-device-width : 414px) and (max-device-width : 736px) and (-webkit-min-device-pixel-ratio : 3){

      .jies{
        margin-top:10px;
        font-size:19px;
      }

    }
    .phone_wrap{
      background-color: rgba(0,0,0,0.7);
      padding:10px 0px;

    }

    img{
      width:100vw;
      height:100vh;
      vertical-align:bottom;
    }
    .slides{
      width:400vw;
      height:100vh;
      -webkit-animation:change 12s ease-in-out infinite;
    }
    .slide{
      width:100vw;
      height:100vh;
      float:left;
    }
    #carousel{
      width:100vw;
      height:100vh;
      overflow:hidden;
    }

    @-webkit-keyframes change{
      0%{
        margin-left:0;
      }
      25%{
        margin-left:0;
      }
      33%{
        margin-left:-100vw;
      }
      58%{
        margin-left:-100vw;
      }
      66%{
        margin-left:-200vw;
      }
      92%{
        margin-left:-200vw;
      }
      100%{
        margin-left:-300vw;
      }
    }

  </style>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6bfdaad88f72215f7d84ab875eb58f0d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);

      _hmt.push(['_trackPageview', "/webcall/call"]);
    })();

  </script>
</head>
<body>
<!--第一页-->
<div class="content1">
  <div id="carousel">
    <div class="slides">
      <div id="son1" class="slide">
        <img src="http://7j1ztl.com1.z0.glb.clouddn.com/webcall_view1.jpeg">
      </div>
      <div id="son2" class="slide">
        <img src="http://7j1ztl.com1.z0.glb.clouddn.com/webcall_view2.jpeg">
      </div>
      <div id="son3" class="slide">
        <img src="http://7j1ztl.com1.z0.glb.clouddn.com/webcall_view3.jpeg">
      </div>
      <div id="son1" class="slide">
        <img src="http://7j1ztl.com1.z0.glb.clouddn.com/webcall_view1.jpeg">
      </div>
    </div>
  </div>
  <button id="phonecall1"></button>
</div>
<!--第二页-->
<div class="content2">
  <ul>
    <li>
      <input type="text" id="phoneNum" placeholder="请输入手机号码" class="wd100 bdr" >
    </li>
    <li>
      <p>请放心,您的号码将仅用于与心理专家联系哟~</p>
    </li>
    <li>
      <button class="wd100 mg bdr" id="veribtn">下一步</button>
    </li>
  </ul>

</div>

<!--第三页-->
<div class="content3">
  <ul>
    <li class="veri">
      <input type="text" placeholder="请输入验证码" id="veri" class="wd100 bdr">
      <!-- <button >获取验证码</button>-->
    </li>
    <li>
      <p>已经向您的手机<span id="userphone">13022222222</span>发送了一条验证短信</p>
    </li>
    <li>
      <button class="wd100 mg bdr" id="confirm">免费戳专家</button>
      <p>为保护您的隐私,稍后将使用010开头的号给您回拨,请注意接听.
        前五分钟通话全程免费
      </p>
    </li>
    <!--<li>
        <p>为保护您的隐私将使用双向回拨给您回电,请注意接听</p>
    </li>-->
  </ul>
</div>

<div class="gray" id="gray" ></div>
<div class="alert" style="padding-bottom:15px" id="suc_alert">


  <!-- <button class="closeAlert"  >

      <img src="https://cdn.juliye.net/btn_close@2x.png">
  </button> -->
  <div class="cushion">
    <!-- <img id="change" src="adviser/images/Loading@3x@3x.png"> -->
    <!-- <div class="spinner">
        <div class="rect1"></div>
        <div class="rect2"></div>
        <div class="rect3"></div>
        <div class="rect4"></div>
        <div class="rect5"></div>
    </div> -->
    <img src="adviser/images/run.gif">

  </div>
  <div class="alert_inf">
    <p>专家来了！请注意静听来电</p>
    <i> 请等待010-57733871的回电 </i>
    <em>您使用的电话是<span id="cellphone"></span></em>
  </div>

</div>
<script>
  var data = '<%-data%>';
  data = data.replace(new RegExp("\r\n", "gm"), "\\r\\n");
  data = data.replace(new RegExp("\n", "gm"), "\\n");
  data = data.replace(new RegExp("\'", "gm"), " ");
  data = JSON.parse(data);

  /*var data={};
   data.phoneNum="";
   data.name="cc";
   data.info={};
   data.info.avatar="yuange";
   data.info.realName="袁葛阿斯顿发";
   data.info.docChatNum="222222";
   data.info.orderNum="15";*/

  window.alert = function(name){
    var iframe = document.createElement("IFRAME");
    iframe.style.display="none";
    iframe.setAttribute("src", 'data:text/plain,');
    document.documentElement.appendChild(iframe);
    window.frames[0].window.alert(name);
    iframe.parentNode.removeChild(iframe);
  }
  $(function(){
    //
    var randnum=Math.ceil(Math.random()*3);
    //alert(randnum);
    /*var picArray=['7j1ztl.com1.z0.glb.clouddn.com/webcall_view3.jpeg','7j1ztl.com1.z0.glb.clouddn.com/webcall_view2.jpeg','http://7j1ztl.com1.z0.glb.clouddn.com/webcall_view1.jpeg'];
     */
    var picArray=['http://7j1ztl.com1.z0.glb.clouddn.com/webcall_view3.jpeg','http://7j1ztl.com1.z0.glb.clouddn.com/webcall_view2.jpeg','http://7j1ztl.com1.z0.glb.clouddn.com/webcall_view1.jpeg'];
    $(".content1").css("background-image",'url('+picArray[randnum-1]+')');



    //手机号验证
    function phone() {
      var phoneNum = $("#phoneNum").val();
      var reg = /^(13|15|18|17)[0-9]{9}$/;
      if(phoneNum=="" || !reg.test(phoneNum)){
        return 1;
      }else{
        $("#phone_alert").hide();
        return 0;
      }
    }

    var timecount = 60;


    //第一个页面点击
    $("#phonecall1").click(function(){
      $(".content1").hide();
      $(".content2").show();

    });

    var phonenumber='';
    //第二个页面点击
    $("#veribtn").click(function () {
      var phone_flag=phone();
      if(phone_flag==1){
        alert("请输入正确的手机号");
        return;
      }
      if(phone_flag==0) {

        timecount=60;
        //getInterval(timecount);
        var phoneNum = $("#phoneNum").val();
        phonenumber=phoneNum;
        $.ajax({
          url: '/1/common/authCode?phoneNum=' + phoneNum,
          type: 'GET',
          success: function (result) {
            console.log("获取验证码成功");
            // phonenumber=$("#phoneNum").val();
            $("#userphone").text(phonenumber);
            $("#cellphone").text(phonenumber);
            $(".content2").hide();

            $(".content3").show();
            //$("#confirm").css("background", "#33A5EE");//写在ajax success里面
            // $("#confirm").attr("disabled", false);//写在ajax success里面
          }
        });
      }
    })


    //第三页


    function closeSuccessAlert(){
      setTimeout(function(){
        suc_alert.hide();
        gray.hide();
      },15000);
    }
    function changeLocation(){
      setTimeout(function(){
        window.location.href="adviser/download.html";
      },15001);
    }
    //获取url
    function getUrlQueryObject(){
      var query = decodeURIComponent(window.location.search.substring(1));
      var urlArray = query.split('&'),queryObj = {};
      urlArray.forEach(function(item){
        var itemArray =  item.split('=');
        queryObj[itemArray[0]] = itemArray[1];
      })
      return queryObj;
    }
    $("#confirm").click(function(){

      // sucdata.doctorId = data.info._id;

      // $(".alert").hide();
      var autoCode=$("#veri").val();
      if(autoCode==''){
        alert('请输入验证码');
        return;
      }

      var sucdata={};
      sucdata=getUrlQueryObject();
      sucdata.phoneNum=$("#phoneNum").val();
      sucdata.authCode=autoCode;
      sucdata.doctorId = data.info._id;
      sucdata.name="用户"+ sucdata.phoneNum.slice(7,11);
      console.log(sucdata);

      $.ajax({
        url: '1/customer/webCall',
        type: 'POST',
        data: JSON.stringify(sucdata),
        dataType:'json',
        headers : {
          "Content-Type": 'application/json'
        },
        success: function (result) {
          $("#suc_alert").show();
          $("#gray").show();
          closeSuccessAlert();
          $("#verification").val("");
          changeLocation();
        },
        error: function (err) {
          console.log(err);
          if( JSON.parse(err.responseText).code == 1502){
            // $("#err_info").text("验证码错误");
            alert("验证码错误");
            //  $("#err_info").show();
          }else if(JSON.parse(err.responseText).code == 1304){
            alert("您拨打的用户正忙")
          }else if(JSON.parse(err.responseText).code == 1202){
            // $("#error").text("你已经注册过朱李叶健康，不能再领取此类优惠")
            /*$("#phoneNumber").hide();
             $("#concernSuccessAlert").show();
             $("#sucVoucher").hide();
             $("#novouchermsg").html('你已经注册过朱李叶健康，不能再领取此类优惠，想了解更多请关注服务窗～');
             $("#noVoucher").show();
             $("#error").hide();*/

          }else{
            /* $("#error").text("请求失败");*/
          }
          /* $("#error").show();*/
        }
      });


    })



  })

</script>
</body>
</html>