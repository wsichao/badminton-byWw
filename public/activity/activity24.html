<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">

    <title>24活动</title>
    <link href="../general_file/general_css.css" rel="stylesheet" type="text/css" />
    <link href="activity.css" rel="stylesheet" type="text/css" />
    <!-- JQuery -->
    <script src="http://7j1ztl.com1.z0.glb.clouddn.com/jquery-2.1.4.min.js"></script>
</head>
<body>
<img src="http://7j1ztl.com1.z0.glb.clouddn.com/upbgNew540_774.png" class="top">
<div class="content">
<div class="share-button" id="shareButton">
    <img src="images/share.png" class="shareBtn" id="share">
</div>
    <div class="share-button" id="useBtn" style="display: none;">
        <img src="images/succes320_188.png" class="shareBtn" id="use" style="width:50%; margin:0 auto; display: block">
    </div>

<div class="Q-A">
    <h4>会员介绍：</h4>
    <ul>
        <li>
            <i>全城购会员有什么权益?</i>
            <span>普通用户成为会员后，可以在指定商户下单可获得商家优惠券和现金红包返现。</span>
        </li>
        <li>
            <i>增加100元会员额度是什么意思？</i>
            <span>用户分享后会增加100元返现额度，该额度会在商家享受优惠时抵扣。举例：会员小明到指定超市消费，一共获得10元优惠，那小明的会员额度还剩90元（100-10）。</span>
        </li>
    </ul>
</div>
<div class="rules">
    <h4>活动规则:</h4>
    <ul>
        <li>1.本活动5元通用券仅适于会员专区商户，仅限会员领取。</li>
        <li>2.同一用户仅限领取1张，同一账户、手机号码、支付账户等均视为同一用户。</li>
        <li>3.本次活动参与用户需先将本活动分享到微信或者朋友圈才可领取，分享后优惠券自动到账。</li>
        <li>4.任何非正常购买的行为，均视为作弊行为，本公司有权取消会员资格。</li>
        <li>5.法律允许范围内，解释权归本公司所有。</li>
    </ul>
</div>
</div>
<script src="../advertising/lib/connectWebViewJavascriptBridge.js"></script>
<script>
    $(function() {
        window.alert = function (name) {
            var iframe = document.createElement("IFRAME");
            iframe.style.display = "none";
            iframe.setAttribute("src", 'data:text/plain,');
            document.documentElement.appendChild(iframe);
            window.frames[0].window.alert(name);
            iframe.parentNode.removeChild(iframe);
        }
        var data = '<%-data%>';
        data = data.replace(new RegExp("\r\n", "gm"), "\\r\\n");
        data = data.replace(new RegExp("\n\r", "gm"), "\\n\\r");
        data = data.replace(new RegExp("\n", "gm"), "\\n");
        data = data.replace(new RegExp("\'", "gm"), " ");
        var initData = JSON.parse(data);
        var webBridge = webViewBridge();
        webBridge.bridgeInit(function (bridge) {
            bridge.registerHandler('shareSuc', function(data,responseCallback){
                $.ajax({
                    type: "GET",
                    url: "/1/customer/sharePromotion",
                    headers: {
                        "x-docchat-user-id":initData.userId,
                        "x-docchat-session-token":initData.token
                    },
                    success: function(rs){
                       $("#shareButton").hide();
                        $("#useBtn").show();
                    },
                    error:function(err){
                        if(JSON.parse(err.responseText).code == 1604){
                            alert("已领取过");
                        }
                        $("#shareButton").show();
                        $("#useBtn").hide();
                    }
                });
            });
        });

        
        var HOST = 'http://web.dc.zlycare.com';
        var REG = /test/;
        //if(window.location.hostname!="dc-c.zlycare.com"){
        if (REG.test(window.location.hostname)){
            HOST = 'http://web.dc-test.zlycare.com';
        }else if(! /zlycare.com/.test(window.location.hostname)){
            HOST = 'http://192.168.3.65:9020';
        }

        $("#share").click(function(){
            var dataShare = {
                title: '周末狂欢5元免费领',
                desc: '立即领取5元代金券及100元会员额度',
                img: 'http://7j1ztl.com1.z0.glb.clouddn.com/share_icon.png',
                url: HOST + "/activity/activity24_Out.html"
            }
            webBridge.upload("shareCoupon",JSON.stringify(dataShare));
        });

        $("#use").click(function(){
            webBridge.upload("gotoVIP");
        });


    });
</script>
</body>
</html>