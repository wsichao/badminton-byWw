<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    <meta name="format-detection" content="telephone=no" />
    <title>24大促会员日</title>
    <link href="../general_file/general_css.css" rel="stylesheet" type="text/css" />
    <link href="activity.css" rel="stylesheet" type="text/css"/>


    <!-- Vue -->
    <!--  <script src="lib/vue.min.js"></script>
      <script src="lib/vue-resource.min.js"></script>-->

    <script src="https://cdn.bootcss.com/vue/2.3.3/vue.min.js"></script>
    <script src="https://cdn.bootcss.com/vue-resource/1.3.1/vue-resource.min.js"></script>

    <script src="../general_file/general_js.js"></script>
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?0d028855732a5d0984ac8d1eca62bbfb";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>

</head>
<body>
<div class="mayActivity">
    <div class="content1">
        <img src="http://7j1ztl.com1.z0.glb.clouddn.com/p1-2@2x.png" alt="17元" v-if="isContent1"/>
        <div class="status" v-if="isContent2">
            <img src="http://7j1ztl.com1.z0.glb.clouddn.com/pagethree_bg.png" alt="领取状态" />
            <p v-text="statusText"></p>
        </div>
    </div>
    <div class="may-content">
        <div class="may-button">
            <input class="input mg" type="text" placeholder="输入手机号领取福利" v-if="isContent1" v-model="phoneNum">
            <button class="btn" v-on:click="getCoupon" v-if="getCouponBtnDisplay">确认领取</button>
            <button class="btn" v-text="buttonText" v-on:click="goUse" v-if="goUseBtnDisplay" id="goUse">立即使用</button>
            <p   v-text="downloadText"></p>
        </div>
        <div class="may-rules">
            <h3>活动规则</h3>
            <ul v-if="isContent1">
                <li>1、代金券需分享后才会到账，代金券只适用于“会员专区”带“活动” 字样商户。</li>
                <li>2、领券的手机号和注册朱李叶健康app的手机号应保持一致，方可领取现金券。每位会员仅能领取一次。</li>
                <li>3、活动起止日期：仅限5月24日当天</li>
                <li>4、在法律允许范围内，本公司拥有活动最终解释权。</li>
            </ul>
            <ul  v-if="isContent2">
                <li>1、代金券需分享后才会到账，代金券只适用于“会员专区”带“活动” 字样商户。</li>
                <li>2、每位会员仅能领取一次，同一设备号、手机、支付账户视为同一用户。</li>
                <li>3、24号当天充值24元即可获得10元代金券礼包，包含2张5元代金券，24号可使用一张，限“会员专区”带“活动”字样商户使用。</li>
                <li>4、活动起止日期：仅限5月24日当天。</li>
                <li>5、在法律允许范围内，本公司拥有活动最终解释权。</li>
            </ul>
        </div>
    </div>
    <div v-if="isLoading">
        <div class="gen-gray-back"  id="gray"></div>
        <div class="alert" style="padding:15px; width:170px; background-color:rgba(255,255,255,0.0)" id="suc_alert">
            <div class="cushion">
                <img src="../apply_doctor/images/Loading@3x@3x.png" id="change">
            </div>
        </div>
    </div>
</div>
<script>
    var vm = new Vue({
        el:".mayActivity",
        data:{
            isContent1:true,
            isContent2:false,
            buttonText:"立即使用",
            statusText:"领取成功!",
            downloadText:'线上领券，线下消费。更多优惠请去会员专区领取',
            phoneNum:'',
            isLoading:true,
            getCouponBtnDisplay:true,
            goUseBtnDisplay:false
        },
        mounted:function(){
            this.isLoading=false;
        },
        methods:{
            getCoupon: function(){
                var reg = /^(13|15|18|17)[0-9]{9}$/;
                if(vm.phoneNum=="" || !reg.test(vm.phoneNum)){
                    alert('请输入正确的手机号');
                    return;
                }
                vm.isLoading = true;
                vm.getCouponBtnDisplay = false;
                vm.goUseBtnDisplay = true;
                this.$http({
                    method: 'GET',
                    url: "/1/activity/share/getCouponInWX170524?phoneNum="+vm.phoneNum,
                    }).then(function(res){
                    console.log(res)
                    vm.isLoading=false;
                    vm.isContent1=false;
                    vm.isContent2=true;
                    vm.downloadText = '下载APP，前往“我的钱包”进行查看';
                },function(err){
                    console.log(err);
                    if(err.body.code){
                        var code=err.body.code;
                        vm.isLoading=false;
                        vm.isContent1=false;
                        vm.isContent2=true;
                        if(code=="1601"){
                            vm.statusText="您已经领取过啦！";
                            vm.downloadText = '下载APP，前往“我的钱包”进行查看';
                        }else if(code == "2202"){
                            vm.buttonText="下载APP，查看更多优惠！";
                            vm.statusText="优惠券被领完啦！";
                            vm.downloadText='';
                        }
                    }else{
                        vm.isLoading=false;
                        alert("领取失败");
                    }

                });
            },
            goUse : function(){
                 window.location.href = "http://a.app.qq.com/o/simple.jsp?pkgname=com.zlycare.docchat.c";
            }
        }
    });
</script>
</body>
</html>